#!/bin/sh
set -e

version="$1"

if [ -z "$version" ]; then
  echo "Usage: <version>"
  exit 1
fi

tmp=$(mktemp)
finish () {
  rm -rf "$tmp"
}
trap finish EXIT

wget -O "$tmp" "https://storage.googleapis.com/golang/go$version.linux-amd64.tar.gz"
mkdir -p "$PREFIX/go"
if [ -d "$PREFIX/go" ]; then
  mv "$PREFIX/go" "$PREFIX/go-$(date --iso-8601)"
fi
tar xzf "$tmp" -C "$PREFIX/go" --strip-components=1
for installer in $HOME/.dotfiles/go/local/bin/install*; do
  if [ "$installer" != "installgo" ]; then
    "$installer"
  fi
done
